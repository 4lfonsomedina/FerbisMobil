<div class="contenedor_pedidos">

</div>



<!-- MODAL CON LOS PROCUCTOS DEL PEDIDO -->
<div id="modal_pedido" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button>
      	<h4 class="modal-title"><b>Contenido del pedido</b></h4></div>
      <div class="modal-body" style="padding: 0px;">
      	<div class="resumen_pedido row">
      		<table style="width: 100%">
      			<tr>
      				<td><b>Productos:</b></td><td class="modal_pedido_productos" align="right"></td>
      				<td><b>Fecha:</b></td><td class="modal_pedido_fecha" align="right"></td>
      			</tr><tr>
      				<td><b>Status:</b></td><td class="modal_pedido_status" align="right"></td>
      				<td><b>*Total:</b></td><td class="modal_pedido_total" align="right"></td>
      			</tr>
      		</table>
      	</div>
      	<div class="contenido_pedido"></div>
      </div>
      <div class="modal-footer">
      	<button type="button" class="btn btn-default" data-dismiss="modal">
            <i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Regresar
        </button>
      </div>
    </div>
  </div>
</div> <!--FIN MODAL-->



<script type="text/javascript">
	$(document).ready(function() {
		$(".contenedor_pedidos").html(loader());
		$.post(url_api+"get_carritos",{id:sesion_local.getItem("FerbisAPP_id")},function(r){
			var string_contenido="";
			if(jQuery.parseJSON(r).length>0){
				$.each(jQuery.parseJSON(r), function( i, pedido ) {
					var estatus = pedido.status;
					var status_desc="";
					if(estatus==0){estatus='info'; 		status_desc='Captura';}
					if(estatus==1){estatus='primary'; 	status_desc='Procesando';}
					if(estatus==2){estatus='success'; 	status_desc='Entregado';}
					string_contenido+='<div class="pedido_row row" id_carrito="'+pedido.id_carrito+'" '+
					'fecha="'+pedido.fecha+'" '+
					'status="'+status_desc+'" '+
					'productos="'+pedido.cantidad+'" '+
					'total="'+parseFloat(pedido.total).toFixed(2)+'" '+
					'">'+
		'<div class="col-xs-3"><span class="label label-'+estatus+'">'+status_desc+'</span></div>'+
		'<div class="col-xs-5"><b>'+pedido.cantidad+' Productos</b><br><span class="small_pedido">'+pedido.fecha+'</span></div>'+
		'<div class="col-xs-4 pedido_tot"><span class="small_pedido"><b>Total aprox</b></span><br>'+parseFloat(pedido.total).toFixed(2)+'</div>'+
	'</div>';
				})

				$(".contenedor_pedidos").html(string_contenido);
			}else{
				$(".contenedor_pedidos").html("<h2 align='center'>No se encontraron pedidos</h2>");
			}
			console.log(r);
		})

		$(document).on("click",".pedido_row",function(){
			$(".modal_pedido_fecha").html($(this).attr('fecha'));
			$(".modal_pedido_status").html($(this).attr('status'));
			$(".modal_pedido_productos").html($(this).attr('productos'));
			$(".modal_pedido_total").html($(this).attr('total'));
			$(".contenido_pedido").html(loader());	
			$.post(url_api+"get_carritos_id",{id:$(this).attr('id_carrito')},function(r){
				$(".contenido_pedido").html(string_carrito_pedido(r));
				$("#modal_pedido").modal("show");
			})
			
		})



		function string_carrito_pedido(string_json){
		var string_ret="";
		$.each(jQuery.parseJSON(string_json), function( i, prod ) {
			var asado=""; if(prod.asado=='1'){ asado='<i class="fa fa-fire ico_asado" aria-hidden="true"></i>';}
			string_ret+="<div class='articulo_carrito_pedido row' >"+
			  				"<div class='col-xs-2 car_cantidad'>"+parseFloat(prod.cantidad).toFixed(2)+"<br><b>"+prod.unidad+"</b></div>"+
			  				"<div class='col-xs-8 car_desc'>"+asado+" "+prod.descripcion+"</div>"+
			  				"<div class='col-xs-2 car_importe'>"+parseFloat(prod.cantidad*prod.precio).toFixed(2)+"</div>"+
			  				"</div>";
		});
		return string_ret;
	}
	});
</script>