<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA2dcvz8j9SEcEv9sYFNuO4iY-Z5-fqEf8"></script>
<div class="contenedor_cuenta" style="height: 70vh;">
<ul class="nav nav-tabs">
	<li class="active"><a data-toggle="tab" href="#contacto">Contacto</a></li>
	<li><a data-toggle="tab" href="#direccion">Direccion</a></li>
</ul>
<form id="form_datos_cuenta">
	<input type="hidden" class="cuenta_id_cliente" name="id_cliente">
	<input type="hidden" class="cuenta_lat" name="lat">
	<input type="hidden" class="cuenta_lon" name="lon">
<div class="tab-content">
	<div id="contacto" class="tab-pane fade in active">
		<table class="table tabla_cuenta">
			<tr>
				<td class="tabla_cuenta_titulo">Nombre</td>
				<td><input type="text" class="form-control cuenta_nombre" name="nombre"></td>
			</tr>
			<tr>
				<td class="tabla_cuenta_titulo">Telefono</td>
				<td><input type="text" class="form-control cuenta_telefono" name="telefono"></td>
			</tr>
			<tr>
				<td class="tabla_cuenta_titulo">Correo</td>
				<td><input type="text" class="form-control cuenta_correo" name="correo"></td>
			</tr>
			<tr>
				<td class="tabla_cuenta_titulo">No.Cliente Frecuente</td>
				<td><input type="text" class="form-control cuenta_numero" name="numero"></td>
			</tr>
		</table>
	</div>
	<div id="direccion" class="tab-pane fade">
		<table class="table tabla_cuenta">
			<tr>
				<td class="tabla_cuenta_titulo">Colonia</td>
				<td colspan="3"><input type="text" class="form-control cuenta_colonia" name="dir_colonia"></td>
			</tr>
			<tr>
				<td class="tabla_cuenta_titulo">Calle</td>
				<td colspan="3"><input type="text" class="form-control cuenta_calle" name="dir_calle"></td>
			</tr>
			<tr>
				<td class="tabla_cuenta_titulo">#ext.</td>
				<td><input type="text" class="form-control cuenta_num" name="dir_numero1"></td>
				<td class="tabla_cuenta_titulo">#int.</td>
				<td><input type="text" class="form-control cuenta_num2" name="dir_numero2"></td>
			</tr>
			<tr>
				<td class="tabla_cuenta_titulo">Referencia</td>
				<td colspan="3"><textarea rows="2" class="form-control cuenta_referencia" name="referencia"></textarea></td>
			</tr>
			<tr>
				<td colspan="4">
					<button type="button" class="btn btn-default btn_mapa_cuenta">
						<i class="fa fa-map-marker" aria-hidden="true"></i> Ubicación
					</button>
				</td>
			</tr>
		</table>
	</div>
</div>
</form>
</div>
<div class="boton_guardar" style="height: 10vh">
	<button type="button" class="btn btn-success btn-lg btn_guardar_cuenta"><i class="fa fa-floppy-o" aria-hidden="true"></i> Guardar datos de cuenta</button>
</div>

<!-- MODAL CON MAPA DE UBICACION -->
<div id="modal_mapa" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button>
      	<h4 class="modal-title"><b>Ubicación</b></h4></div>
      <div class="modal-body">
      	<div id="map_cuenta" style="height: 300px;"></div>
      </div>
      <div class="modal-footer">
      	<button type="button" class="btn btn-warning" data-dismiss="modal">
            <i class="fa fa-reply" aria-hidden="true"></i> Regresar
        </button>
      </div>
    </div>
  </div>
</div> <!--FIN MODAL-->


<script type="text/javascript">
	$(document).ready(function() {
		$(document).on("click",".btn_guardar_cuenta",function(){
			$.post(url_api+'actualizar_cuenta',$("#form_datos_cuenta").serialize(),function(r){
				notificacion("Datos Guardados con exito!");
			})
		})
		$.post(url_api+'datos_cuenta',{id_cliente:sesion_local.getItem("FerbisAPP_id")},function(r){
			var cuenta = jQuery.parseJSON(r);
			$(".cuenta_id_cliente").val(cuenta.id_cliente);
			$(".cuenta_lat").val(cuenta.lat);
			$(".cuenta_lon").val(cuenta.lon);
			$(".cuenta_nombre").val(cuenta.nombre);
			$(".cuenta_telefono").val(cuenta.telefono);
			$(".cuenta_correo").val(cuenta.correo);
			$(".cuenta_numero").val(cuenta.numero);
			$(".cuenta_colonia").val(cuenta.dir_colonia);
			$(".cuenta_calle").val(cuenta.dir_calle);
			$(".cuenta_num").val(cuenta.dir_numero1);
			$(".cuenta_num2").val(cuenta.dir_numero2);
			$(".cuenta_referencia").val(cuenta.referencia);
		})
		$(document).on("click",".btn_mapa_cuenta",function(){
			$("#modal_mapa").modal("show");

			//si existen las coordenadas no se hace geolocalizacion
			if($(".cuenta_lat").val()!=0&&$(".cuenta_lon").val()!=0){
				construir_mapa({lat: parseFloat($(".cuenta_lat").val()), lng: parseFloat($(".cuenta_lon").val())});
			}else{
				var direccion=	$(".cuenta_calle").val()+", "+
								$(".cuenta_num").val()+", "+
								$(".cuenta_colonia").val()+
								", Mexicali, BC";
				geocoder = new google.maps.Geocoder();
				geocoder.geocode({ 'address': direccion}, function(results, status) {
					$(".cuenta_lat").val(results[0].geometry.location.lat);
					$(".cuenta_lon").val(results[0].geometry.location.lng);
					construir_mapa(results[0].geometry.location);
				});
			}
			

			function construir_mapa(myLatLng){
				var map = new google.maps.Map(document.getElementById('map_cuenta'), {
		          zoom: 17,
		          center: myLatLng
		        });
		        var marker = new google.maps.Marker({
		          draggable: true,
		          animation: google.maps.Animation.DROP,
		          position: myLatLng,
		          map: map,
		          title: 'Ferbis Brasil'
		        });
		        map.addListener('click', function(e) {
					marker.setPosition(e.latLng);
					$(".cuenta_lat").val(e.latLng.lat);
					$(".cuenta_lon").val(e.latLng.lng);
				});
			}
		})

	});
</script>


